Create AWS AMI with custom SSH username and password - CloudTern Solutions
Create AWS AMI with custom SSH username and password
September 3, 2017
by
Ramu Kambalapuram
Blog
Introduction
EC2 instance that is launched with Amazon Linux AMI will come up with ec2-user and you can only SSH into that instance with Private Key.
Need
We wanted an Amazon Linux AMI (Base Image) with default username (similar to ec2-user) and that should allow SSH login with a password.
SSH login with a password is also a requirement for authenticating user login with OpenLDAP Server. That way our IT Operations need not remember new login information.  They can use their existing logins.
Solution
Launch Amazon Linux AMI micro instance.
Connect to instance with private key
Create SSH User and give sudo permission  (similar to ec2-user)
sudo useradd -s /bin/bash -m -d /home/<ssh-user-home-directory> -g root <ssh-user-name>
sudo passwd <ssh-user-name>
Enable Password login for SSH (add following snippet of code at the end of /etc/rc.local file)
if grep -Fxq “PasswordAuthentication no” /etc/ssh/sshd_config
then
#This instance launched for this first time, pleae enable SSH with password login
sed -i ‘s/^PasswordAuthentication.*/PasswordAuthentication yes/’ /etc/ssh/sshd_config
/etc/init.d/sshd restart
fi
This piece of code will change
PasswordAuthentication
to
yes
in
sshd_config
file. (If we don’t do       this every time we create Instance with AMI that will overwrite sshd_config file)
Stop the instance
Select Instance and create Image
Now launch Instance with above created AMI.
After Instance is launched you can log in with ssh username you have created in step 3.
aws
AWS Networking
Share
Related Posts
September 4, 2024
Blog
AI Innovation with AWS Infrastructure and Managed Services
August 30, 2024
Blog
Revolutionizing Logistics with IoT: Tracking, Fleet Management, and Automation
August 21, 2024
Blog
Supercharging AWS Cloud Operations: A Journey from Docker to Kubernetes
Prev
Next
CloudTern offers highly scalable software solutions that enable organizations to securely drive innovation into business processes
Contacts
+1 (945) 216-6923
info@cloudtern.com
8105 Rasor Blvd Ste 236
Plano, TX – 75024
Linkedin-in
Twitter
Instagram
Services
Quick Links
© 2025 — CloudTern. All Rights Reserved.